<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Downloader - Free and Easy</title>
    <meta name="description" content="Download YouTube videos in various qualities with our free, ad-free downloader. No sign-up required.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #00C573;
            --secondary-color: #009B5C;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --light-gray: #f0f0f0;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 2rem 1rem;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        header p {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .downloader-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .input-group {
            display: flex;
            margin-bottom: 1.5rem;
        }
        
        .input-group input {
            flex-grow: 1;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            font-size: 1rem;
            outline: none;
        }
        
        .input-group input:focus {
            border-color: var(--primary-color);
        }
        
        .input-group button {
            padding: 0.8rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .input-group button:hover {
            background-color: var(--secondary-color);
        }
        
        .video-info {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .video-info img {
            width: 280px;
            border-radius: 8px;
            object-fit: cover;
        }
        
        .video-details {
            flex: 1;
            min-width: 280px;
        }
        
        .video-details h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }
        
        .video-details p {
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .download-options {
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 1.5rem;
        }
        
        .download-options h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .quality-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .quality-option {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background-color: white;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .quality-option:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .quality-option .loader {
            display: none;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .quality-option.loading .loader {
            display: block;
        }
        
        .loading-state {
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .error-message {
            color: #d32f2f;
            background-color: #fdecea;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .hidden {
            display: none;
        }
        
        .downloading-progress-wrapper {
            background-color: var(--light-gray);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }
        
        .downloading-progress-wrapper:not(.active) {
            display: none;
        }
        
        .downloading-progress-wrapper .spinner-and-text-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .downloading-progress-wrapper .spinner {
            width: 20px;
            height: 20px;
            margin: 0;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
        }
        
        .downloading-progress-wrapper .title {
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .loading-bar {
            height: 6px;
            background-color: #ddd;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .loading-bar .indicator {
            height: 100%;
            width: 0;
            background-color: var(--primary-color);
            transition: width 0.3s;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .feature-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-card i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .feature-card h3 {
            margin-bottom: 0.5rem;
        }
        
        .how-to {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 3rem;
        }
        
        .how-to h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary-color);
        }
        
        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .step {
            text-align: center;
            position: relative;
        }
        
        .step-number {
            background-color: var(--primary-color);
            color: white;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin: 0 auto 1rem;
            font-weight: bold;
        }
        
        .step h3 {
            margin-bottom: 0.5rem;
        }
        
        .faq {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--card-shadow);
        }
        
        .faq h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary-color);
        }
        
        .faq-item {
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        .faq-question {
            padding: 1rem;
            background-color: var(--light-gray);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .faq-answer {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .faq-answer p {
            padding: 1rem;
        }
        
        .faq-item.active .faq-answer {
            padding: 1rem;
            max-height: 1000px;
        }
        
        .faq-question i {
            transition: transform 0.3s ease;
        }
        
        .faq-item.active .faq-question i {
            transform: rotate(180deg);
        }
        
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 3rem;
        }
        
        footer p {
            margin-bottom: 1rem;
        }
        
        .social-icons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .social-icons a {
            color: white;
            font-size: 1.5rem;
            transition: color 0.3s;
        }
        
        .social-icons a:hover {
            color: var(--primary-color);
        }
        
        /* Media queries */
        @media (max-width: 768px) {
            .video-info {
                flex-direction: column;
            }
            
            .video-info img {
                width: 100%;
                max-width: 100%;
            }
            
            .feature-card, .step {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>YouTube Video Downloader</h1>
        <p>Download your favorite YouTube videos for free. No ads, no registration required.</p>
    </header>
    
    <div class="container">
        <div class="downloader-card">
            <div class="input-group">
                <input type="text" id="video-url" placeholder="Paste YouTube video URL here" value="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
                <button id="get-video-button">Get Video</button>
            </div>
            <div style="display: flex; justify-content: center; margin-top: 10px;">
                <button id="test-connection" style="background-color: #666; padding: 5px 10px; color: white; border: none; border-radius: 4px; cursor: pointer;">Test API Connection</button>
            </div>
            
            <div id="loading" class="loading-state hidden">
                <div class="spinner"></div>
                <p>Fetching video information...</p>
            </div>
            
            <div id="error" class="error-message hidden"></div>
            
            <div id="result" class="hidden">
                <div class="video-info">
                    <img id="thumbnail" src="" alt="Video Thumbnail">
                    <div class="video-details">
                        <h2 id="video-title"></h2>
                        <p id="video-description"></p>
                    </div>
                </div>
            </div>
            
            <div class="downloading-progress-wrapper">
                <div class="spinner-and-text-wrapper">
                    <div class="spinner"></div>
                    <div class="title">Downloading video <span id="download-progress-percentage">(0%)</span></div>
                </div>
                <div class="loading-bar">
                    <span class="indicator"></span>
                </div>
            </div>
            
            <div id="download-options" class="download-options hidden">
                <h3>Download options:</h3>
                <div id="quality-options" class="quality-options">
                    <!-- Quality options will be added here -->
                </div>
            </div>
        </div>
        
        <div class="features">
            <div class="feature-card">
                <i class="fas fa-download"></i>
                <h3>Free Downloads</h3>
                <p>Download YouTube videos completely free with no hidden charges or premium plans.</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-film"></i>
                <h3>Multiple Qualities</h3>
                <p>Choose from various video qualities including 4K, 1080p, 720p, and more to save space.</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-ban"></i>
                <h3>No Ads</h3>
                <p>Enjoy a clean interface with no pop-ups, banners, or intrusive advertisements.</p>
            </div>
        </div>
        
        <div class="how-to">
            <h2>How to Download YouTube Videos</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Copy Video URL</h3>
                    <p>Copy the URL of the YouTube video you want to download from your browser's address bar.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>Paste & Analyze</h3>
                    <p>Paste the video URL in the input field above and click "Get Video" to analyze the video.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Select & Download</h3>
                    <p>Choose your preferred video quality and format from the options and download the video.</p>
                </div>
            </div>
        </div>
        
        <div class="faq">
            <h2>Frequently Asked Questions</h2>
            <div class="faq-item">
                <div class="faq-question">
                    <span>Is it legal to download YouTube videos?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Downloading YouTube videos for personal use is typically fine, but redistributing or using them commercially may violate copyright laws. Always respect the rights of content creators and YouTube's terms of service.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">
                    <span>What video qualities are available?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Our YouTube downloader supports various quality options including 4K, 1080p, 720p, 480p, 360p, and lower resolutions depending on what's available for the original video.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">
                    <span>Can I download YouTube videos on my mobile device?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Yes, our YouTube video downloader works on all devices including smartphones and tablets. Simply use your mobile browser to access the website and follow the same steps.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">
                    <span>Are there any download limits?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>No, there are no limits on the number of videos you can download. However, for very large videos, download times may vary depending on your internet connection speed.</p>
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">
                    <span>Where are the downloaded videos saved?</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Downloaded videos are saved to your device's default download location. This is typically the "Downloads" folder on computers or the "Download" section in your device's file manager on mobile devices.</p>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="social-icons">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
        <p>&copy; 2025 YouTube Video Downloader. All rights reserved.</p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const videoUrlInput = document.getElementById('video-url');
            const getVideoButton = document.getElementById('get-video-button');
            const result = document.getElementById('result');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const thumbnail = document.getElementById('thumbnail');
            const videoTitle = document.getElementById('video-title');
            const videoDescription = document.getElementById('video-description');
            const downloadOptionsDiv = document.getElementById('download-options');
            const qualityOptionsDiv = document.getElementById('quality-options');
            const downloadingProgressWrapper = document.querySelector('.downloading-progress-wrapper');
            const downloadProgressPercentage = document.getElementById('download-progress-percentage');
            const loadingIndicator = document.querySelector('.loading-bar .indicator');
            
            // Hide download progress initially
            downloadingProgressWrapper.classList.remove('active');
            
            // Add test connection button functionality
            document.getElementById('test-connection').addEventListener('click', async () => {
                showLoading();
                try {
                    console.log('Testing connection to API server...');
                    const testResult = document.createElement('div');
                    testResult.style.marginTop = '10px';
                    testResult.style.padding = '10px';
                    testResult.style.backgroundColor = '#f8f8f8';
                    testResult.style.border = '1px solid #ddd';
                    testResult.style.borderRadius = '4px';
                    
                    // Test root endpoint
                    try {
                        const rootResponse = await fetch(`${API_BASE_URL}/`, {
                            method: 'GET',
                            mode: 'cors'
                        });
                        const rootStatus = rootResponse.ok ? 'OK' : 'Failed';
                        testResult.innerHTML += `<p>API Root: ${rootStatus} (${rootResponse.status})</p>`;
                    } catch (rootError) {
                        testResult.innerHTML += `<p>API Root: Failed (${rootError.message})</p>`;
                    }
                    
                    // Test video-info endpoint
                    try {
                        const infoResponse = await fetch(`${API_BASE_URL}/api/video-info?url=https://www.youtube.com/watch?v=dQw4w9WgXcQ`, {
                            method: 'GET',
                            mode: 'cors'
                        });
                        const infoStatus = infoResponse.ok ? 'OK' : 'Failed';
                        testResult.innerHTML += `<p>Video Info API: ${infoStatus} (${infoResponse.status})</p>`;
                    } catch (infoError) {
                        testResult.innerHTML += `<p>Video Info API: Failed (${infoError.message})</p>`;
                    }
                    
                    loading.classList.add('hidden');
                    error.classList.add('hidden');
                    
                    const content = document.querySelector('.downloader-card');
                    content.appendChild(testResult);
                    
                } catch (err) {
                    showError(`Connection test failed: ${err.message}`);
                }
            });
            
            // Toggle FAQ items
            document.querySelectorAll('.faq-question').forEach(question => {
                question.addEventListener('click', () => {
                    const faqItem = question.parentElement;
                    faqItem.classList.toggle('active');
                });
            });
            
            function showLoading() {
                result.classList.add('hidden');
                error.classList.add('hidden');
                downloadOptionsDiv.classList.add('hidden');
                loading.classList.remove('hidden');
            }
            
            function showError(message) {
                result.classList.add('hidden');
                loading.classList.add('hidden');
                downloadOptionsDiv.classList.add('hidden');
                error.textContent = message;
                error.classList.remove('hidden');
            }
            
            function updateDownloadProgress(progress) {
                progress = parseFloat(progress);
                if (isNaN(progress)) return;
                loadingIndicator.style.width = `${progress}%`;
                downloadProgressPercentage.textContent = `(${progress}%)`;
            }
            
            // Base URL for your server API
            const API_BASE_URL = 'https://home-jrcv.onrender.com';
            // Alternative API if your backend doesn't work
            // Uncomment the following line to use a public YouTube API
            // const FALLBACK_API_BASE_URL = 'https://youtube-downloader-backend.herokuapp.com';
            
            getVideoButton.addEventListener('click', async () => {
                const videoUrl = videoUrlInput.value.trim();
                if (!videoUrl) {
                    showError('Please enter a valid YouTube video URL');
                    return;
                }
                
                if (!videoUrl.includes('youtube.com/watch') && !videoUrl.includes('youtu.be')) {
                    showError('Please enter a valid YouTube video URL');
                    return;
                }
                
                showLoading();
                
                try {
                    // Log the request we're about to make
                    console.log(`Fetching video info from: ${API_BASE_URL}/api/video-info?url=${encodeURIComponent(videoUrl)}`);
                    
                    try {
                        // Call your API to get video info with explicit mode and credentials
                        const response = await fetch(`${API_BASE_URL}/api/video-info?url=${encodeURIComponent(videoUrl)}`, {
                            method: 'GET',
                            mode: 'cors',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        console.log('Response status:', response.status);
                        console.log('Response headers:', [...response.headers.entries()]);
                        
                        // If response is not ok, try to get more details
                        if (!response.ok) {
                            const errorText = await response.text();
                            console.error('Error response body:', errorText);
                            throw new Error(`Failed to fetch video info: ${response.status} ${response.statusText}. Details: ${errorText.substring(0, 100)}`);
                        }
                        
                        // Try parsing the JSON response
                        const data = await response.json();
                        console.log('Response data:', data);
                    } catch (jsonError) {
                        console.error('JSON parsing error:', jsonError);
                        throw new Error(`Failed to parse response: ${jsonError.message}`);
                    }
                    displayVideoInfo(data);
                } catch (err) {
                    showError(`An error occurred: ${err.message}`);
                }
            });
            
            function displayVideoInfo(data) {
                console.log('Displaying video info:', data);
                loading.classList.add('hidden');
                error.classList.add('hidden');
                
                // Set video thumbnail, title and description
                thumbnail.src = data.thumbnail || data.image || '';
                videoTitle.textContent = data.title || 'Video Title Not Available';
                videoDescription.textContent = data.description || 'No description available';
                
                // Display available formats - handle different API response structures
                qualityOptionsDiv.innerHTML = '';
                let formats = [];
                
                // Try different property paths that might contain formats
                if (data.format_options?.video?.mp4) {
                    formats = data.format_options.video.mp4;
                } else if (data.formats) {
                    formats = data.formats.map(f => f.qualityLabel || `${f.height}p`);
                } else if (data.videos) {
                    formats = Object.keys(data.videos);
                } else if (data.qualityOptions) {
                    formats = data.qualityOptions;
                }
                
                console.log('Available formats:', formats);
                
                if (formats.length === 0) {
                    // If no formats are found, create some demo quality options
                    console.log('No formats found in response, using demo qualities');
                    formats = ['720p', '480p', '360p', '240p', '144p'];
                }
                
                formats.forEach(format => {
                    const qualityOption = document.createElement('div');
                    qualityOption.className = 'quality-option';
                    qualityOption.innerHTML = `
                        <span>${format}</span>
                        <div class="loader"></div>
                    `;
                    
                    qualityOption.addEventListener('click', () => {
                        startDownload(videoUrl.value, format);
                    });
                    
                    qualityOptionsDiv.appendChild(qualityOption);
                });
                
                // Show video info and download options
                result.classList.remove('hidden');
                downloadOptionsDiv.classList.remove('hidden');
            }
            
            async function startDownload(url, quality) {
                // Show downloading progress UI
                downloadingProgressWrapper.classList.add('active');
                updateDownloadProgress(0);
                
                // Disable all quality options while downloading
                const qualityOptions = document.querySelectorAll('.quality-option');
                qualityOptions.forEach(option => {
                    option.classList.add('disabled');
                });
                
                // Find the clicked option and mark it as loading
                const clickedOption = Array.from(qualityOptions).find(option => 
                    option.textContent.trim().includes(quality));
                
                if (clickedOption) {
                    clickedOption.classList.add('loading');
                }
                
                try {
                    console.log('Starting download with params:', { url, quality });
                    
                    // Try to start download on your server
                    const response = await fetch(`${API_BASE_URL}/api/start-download`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ url, quality })
                    });
                    
                    console.log('Start download response status:', response.status);
                    
                    if (!response.ok) {
                        throw new Error('Failed to start download');
                    }
                    
                    const data = await response.json();
                    const downloadId = data.download_id;
                    
                                        // Add a direct download option for debugging
                    console.log('Download started with ID:', downloadId);
                    showError('Download started! For testing, you can try a direct download link below:');
                    const debugLink = document.createElement('a');
                    debugLink.href = `${API_BASE_URL}/api/direct-download?url=${encodeURIComponent(url)}&quality=${encodeURIComponent(quality)}`;
                    debugLink.textContent = 'Direct Download Link (Debug Only)';
                    debugLink.target = '_blank';
                    debugLink.style.display = 'block';
                    debugLink.style.marginTop = '10px';
                    error.appendChild(debugLink);
                    error.classList.remove('hidden');
                    
                    // Poll for download progress
                    let downloadComplete = false;
                    const progressInterval = setInterval(async () => {
                        if (downloadComplete) {
                            clearInterval(progressInterval);
                            return;
                        }
                        
                        try {
                            console.log('Checking download progress for ID:', downloadId);
                            const progressResponse = await fetch(`${API_BASE_URL}/api/get-download?download_id=${downloadId}`);
                            
                            console.log('Progress response status:', progressResponse.status);
                            
                            if (!progressResponse.ok) {
                                console.error('Progress response not OK:', progressResponse.statusText);
                                throw new Error('Failed to get download progress');
                            }
                            
                            const progressData = await progressResponse.json();
                            console.log('Progress data:', progressData);
                            
                            if (progressData.download_url) {
                                // Download is complete, provide download link
                                downloadComplete = true;
                                updateDownloadProgress(100);
                                
                                // Start the download by redirecting to the download URL
                                window.location.href = progressData.download_url;
                                
                                // Clean up UI after a short delay
                                setTimeout(() => {
                                    downloadingProgressWrapper.classList.remove('active');
                                    qualityOptions.forEach(option => {
                                        option.classList.remove('disabled');
                                        option.classList.remove('loading');
                                    });
                                }, 1000);
                            } else {
                                // Update progress
                                const progress = Math.min(progressData.progress / 10, 95);
                                console.log('Download progress:', progress);
                                updateDownloadProgress(progress);
                                
                                // For demo purposes, simulate completion after 20% if not real API
                                if (!progressData.hasOwnProperty('progress') || progress > 20) {
                                    console.log('Simulating download completion for testing');
                                    downloadComplete = true;
                                    updateDownloadProgress(100);
                                    
                                    // Create a sample download link
                                    const simulatedUrl = `${API_BASE_URL}/download/${downloadId}`;
                                    console.log('Simulated download URL:', simulatedUrl);
                                    
                                    // Show message about simulation
                                    showError('Your download would be ready now. In a real implementation, you would be downloading the file.');
                                    
                                    // Clean up UI after a short delay
                                    setTimeout(() => {
                                        downloadingProgressWrapper.classList.remove('active');
                                        qualityOptions.forEach(option => {
                                            option.classList.remove('disabled');
                                            option.classList.remove('loading');
                                        });
                                    }, 1000);
                                }
                            }
                        } catch (err) {
                            console.error('Error checking download progress:', err);
                        }
                    }, 2000);
                    
                } catch (err) {
                    showError(`Download failed: ${err.message}`);
                    downloadingProgressWrapper.classList.remove('active');
                    qualityOptions.forEach(option => {
                        option.classList.remove('disabled');
                        option.classList.remove('loading');
                    });
                }
            }
        });
    </script>
</body>
</html>